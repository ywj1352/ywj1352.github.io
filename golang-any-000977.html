<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;♾️&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>golang @any%&nbsp;|&nbsp;humblog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="golang @any%">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;✔️&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;♾️&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🌖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;✔️&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">golang @any%</h1>
    
  </header>
  <article id="https://www.notion.so/000977692aac4b6f8f37d9b658d46b2e" class="PageRoot"><div id="https://www.notion.so/6c4145444db9406ca2293c10188e07ba" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Notion Tip: </strong></span><span class="SemanticString">Please read </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/aceld/golang/tree/main">golang修养之路</a></span><span class="SemanticString"> to develop a basic understanding about go. I assume you have already known the syntax and memory model in cpp.</span></span></p></div><blockquote id="https://www.notion.so/2896ce0a055643f781e1d6f543d97830" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">GO哲学圣经镇楼：
Do not communicate by sharing memory; instead, share memory by communicating.</span></span></blockquote><ul id="https://www.notion.so/477838fddaad478693d345ab45602d2b" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/4c33e1a184e94f05b5406a860e1a7a87"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">nil</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/1d38a5638a804f7fb51f20d8790e8aeb"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">Interface &amp; Memory model</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/73eadbc2bd51408aa7b89a457805d0a0"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">const</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9b1caf43af8f40be8e24dfd62ebd3947"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">make &amp; new</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e45d7d53343c4f41a317863b05a4b5f9"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Declaration of var</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ec83d33fc67a4a65ba9f9574aad94b8d"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">Escape</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/cdb213c0c8124d79975a283f87753977"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">Pointer type &amp; struct type </span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/730abf03560249b08a28c0d26ede956a"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">Garbage collection (IMPORTANT!)</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/a24495e9a84a4472862f421119a42833"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">一些理解</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/82316c3c58d84addb96b6d59fe14cf41"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">Complement</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/1118f9b4570947ebb009136d01e25806"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">map</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/2fb6624370db49608f40b9ca8ca55826"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">slice</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/dc9a4365b2b74896a29989c98639f914"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">compile</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5bed3069fd7b465faeb0d8d5e9a3ff66"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">context</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/34705a0814c24354bf34ff9d65e760e8"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">reflect</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/c20c1bf6fbdc45a4ab01caebea5ebdf6"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">unsafe</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/17324127239b4a08bf1a4c164f0be21f"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">interface</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b8fd5d9dc27d4b5bb53e9c536b09e85d"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">channel</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6d568857939045de94583f27517fe07b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">GMP</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b8c4fd33b8b74519bcb53a007170d2fe"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">GO实战</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5e78559701aa4ddeb976beda3a612475"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Web</span></span></div></a></li></ul><h1 id="https://www.notion.so/4c33e1a184e94f05b5406a860e1a7a87" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/4c33e1a184e94f05b5406a860e1a7a87"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">nil</span></span></h1><div id="https://www.notion.so/a829bc22cd1143889a29413f85e079f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">In Go, </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">nil</code></span><span class="SemanticString"> can represent zero values of the following kinds of types:</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/9f55e98a3e734dc9b3733cc9b2f39973" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">pointer types (including type-unsafe ones).</span></span></li><li id="https://www.notion.so/9ace9536b1ce4bc1a2378a72a1210532" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">map types.</span></span></li><li id="https://www.notion.so/102e1214feb34d039a675f87c5181014" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">slice types.</span></span></li><li id="https://www.notion.so/9d725fe3b920433eb7b802b51e79c5f1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">function types.</span></span></li><li id="https://www.notion.so/c1edcb75939b431caa529a3c555f65a0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">channel types.</span></span></li><li id="https://www.notion.so/dd2ddba3184f4a0a9d2e8e590159d9fd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">interface types.</span></span></li></ul><div id="https://www.notion.so/ed668da1a1df4d048d0a11cc55a7860c" class="Divider"></div><h1 id="https://www.notion.so/1d38a5638a804f7fb51f20d8790e8aeb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/1d38a5638a804f7fb51f20d8790e8aeb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Interface &amp; Memory model</span></span></h1><div id="https://www.notion.so/6d75c0f9bac3452b8bcb31a03063c0ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在 Go 语言中，接口类型的内存模型是指，一个接口变量实际上只是一个包含指向底层数据的指针和类型信息的数据结构。该指针指向实现了该接口的具体类型的实例。因此，使用接口类型时，实际上使用的是底层数据的指针。</span></span></p></div><pre id="https://www.notion.so/07bbda2667ed4158a031afec1dff7cf1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>type Animal interface {
    Speak() string
}

type Dog struct {
    Name string
}

func (d *Dog) Speak() string {
    return &quot;Woof!&quot;
}</span></span></span></code></pre><div id="https://www.notion.so/5faf6f77cd3a43efbc883e8ce4f702ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们现在将 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dog</code></span><span class="SemanticString"> 类型的值赋给 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Animal</code></span><span class="SemanticString"> 类型的变量：</span></span></p></div><pre id="https://www.notion.so/d41ef1cb04c14d79a1e32a0b98450eb5" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>var animal Animal = &amp;Dog{&quot;Fido&quot;}</span></span></span></code></pre><div id="https://www.notion.so/c88b132a278642b484174ca71ee5d3b4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在这个例子中，我们为 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dog</code></span><span class="SemanticString"> 结构体实现了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Speak()</code></span><span class="SemanticString"> 方法，并将其赋给了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Animal</code></span><span class="SemanticString"> 接口类型的变量 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">animal</code></span><span class="SemanticString">。由于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dog</code></span><span class="SemanticString"> 实现了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Animal</code></span><span class="SemanticString"> 接口，所以可以将 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dog</code></span><span class="SemanticString"> 实例作为 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Animal</code></span><span class="SemanticString"> 类型的值传递。</span></span></p></div><div id="https://www.notion.so/c9cb997e80b8431b9e5df2323dd85bec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在这里，变量 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">animal</code></span><span class="SemanticString"> 中实际上存储了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dog</code></span><span class="SemanticString"> 实例的地址信息，以及对应的类型信息。当我们调用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">animal.Speak()</code></span><span class="SemanticString"> 方法时，由于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dog</code></span><span class="SemanticString"> 类型实现了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Speak()</code></span><span class="SemanticString"> 方法，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Go 会自动将底层值指针转换为 </strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><code class="SemanticString__Fragment SemanticString__Fragment--Code">*Dog</code></strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> 类型</strong></span><span class="SemanticString">，并调用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Speak()</code></span><span class="SemanticString"> 方法。</span></span></p></div><div id="https://www.notion.so/7a82cad2f707493e8dc6d341ad2f3fa2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">需要注意的是，由于指针包含了地址信息，因此通过接口来操作变量的时候，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">会使用额外的内存进行指针的转换</strong></span><span class="SemanticString">。此外，当使用接口类型时，由于需要动</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">态判断底层数据的类型</strong></span><span class="SemanticString">，因此会导致一些性能上的损失。</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">编译器来检查一个类型是否实现了某个接口的所有方法</strong></span><span class="SemanticString">。如果一个类型没有实现某个接口的全部方法，则会在编译时产生错误。</span></span></p></div><h1 id="https://www.notion.so/73eadbc2bd51408aa7b89a457805d0a0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/73eadbc2bd51408aa7b89a457805d0a0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">const</span></span></h1><div id="https://www.notion.so/a6fa3ca81db34462b0fe86b14651d196" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">C++ 和 Go 两种语言中的常量有所不同，可能导致它们在寻址方面的特性表现不同。</span></span></p></div><div id="https://www.notion.so/36977c4ee548451f8578548e59a4238e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">在 C++ 中，常量（如 </strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><code class="SemanticString__Fragment SemanticString__Fragment--Code">const int a = 10</code></strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">）实际上是变量，只是它们被声明为不可修改</strong></span><span class="SemanticString">（即 const 类型），因此编译器会将这些变量存储在内存中的只读区域。因为它们实际上是变量，在内存中占用了一定的空间，所以可以对其取地址。</span></span></p></div><div id="https://www.notion.so/c454ea88d88641808c8ae5c39adb9445" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">而在 Go 中，常量（如 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">const a = 10</code></span><span class="SemanticString">）是无类型的，它们在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">编译时就被解析并直接替换为使用该常量的值</strong></span><span class="SemanticString">。也就是说，在编译时，它们不会分配任何内存，并且不属于程序的运行时状态。因此，Go 编译器不支持获取常量的地址，因为它们没有在内存中分配任何空间。</span></span></p></div><div id="https://www.notion.so/81780ed13bfd461f9aa36dee14218a87" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">总的来说，C++ 和 Go 中的常量有着不同的实现方式和语义约束。C++ 中的常量是实际的变量，但被限制为不可修改；而</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> Go 中的常量则是编译时常量，它们在程序运行时不存在</strong></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/0882f6d807e944ab93b482184e3dbb85" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">需要注意的是，某些 C++ 编译器可能会将常量优化为立即数，这样，它们就不会在内存中分配任何空间。这种优化行为类似于 Go 中的常量实现方式。因此，在 C++ 中也应该避免对常量进行不必要的取地址操作，这些操作可能会被编译器优化掉，或者在某些平台上导致未定义的行为。</span></span></p></div><h1 id="https://www.notion.so/9b1caf43af8f40be8e24dfd62ebd3947" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/9b1caf43af8f40be8e24dfd62ebd3947"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">make &amp; new</span></span></h1><div id="https://www.notion.so/a29567b180104090bd2a2833658b9116" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">make</code></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">只能用于 slice, map 和 chan</mark></span></span></p></div><h3 id="https://www.notion.so/e45d7d53343c4f41a317863b05a4b5f9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e45d7d53343c4f41a317863b05a4b5f9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Declaration of var</span></span></h3><pre id="https://www.notion.so/760fac1fb13345b2ab21331d32c8bf67" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>var i int
var s string</span></span></span></code></pre><div id="https://www.notion.so/9d0365fe39db4b4082a3f43ed4b96f6b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">变量的声明我们可以通过var关键字，然后就可以在程序中使用。当我们不指定变量的默认值时，这些变量的默认值是他们的零值，比如int类型的零值是0,string类型的零值是 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&quot;&quot;</code></span><span class="SemanticString">，引用类型的零值是 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">nil</code></span><span class="SemanticString">。</span></span></p></div><pre id="https://www.notion.so/1babacd6be6942769b598833937b7d29" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package main

import (
	&quot;fmt&quot;
)

func main() {
	var i *int
	*i = 10
	fmt.Println(*i)
}</span></span></span></code></pre><div id="https://www.notion.so/c0e93df038ab4fdb9cdb0e69764f9dda" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以上代码会报错，对于引用类型的变量，我们不光要声明它，还要为它分配内容空间，正确代码如下</span></span></p></div><pre id="https://www.notion.so/0bf8ebf3c6d54c45a7f21f797a9beeba" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>func main() {
  
   var i *int
   i=new(int)
   *i=10
   fmt.Println(*i)
  
}</span></span></span></code></pre><div id="https://www.notion.so/e30d59a6ffe74808964ac6343d285412" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/74b3e755e1c5441f8a59430b7c540c85" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">new</code></span><span class="SemanticString"> 函数用于分配一个指定类型的零值并返回该类型的指针。换句话说，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">new(T)</code></span><span class="SemanticString"> 返回类型为 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">T</code></span><span class="SemanticString"> 的指针，并将其初始化为 T 的零值。例如，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">new(int)</code></span><span class="SemanticString"> </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">创建一个整数类型的指针</strong></span><span class="SemanticString">，并将其</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">初始化为零值 0</strong></span><span class="SemanticString">。</span></span></li><li id="https://www.notion.so/ee1f7f5c2d5043fe82e57009418919a6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">make</code></span><span class="SemanticString"> 函数用于创建引用类型（如 slice、map 和 channel）的对象，并</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">返回它们的引用</strong></span><span class="SemanticString">。它接受一个类型和一些适当的参数，然后</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">返回初始化后的对象</strong></span><span class="SemanticString">。例如，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">make([]int, 10)</code></span><span class="SemanticString"> 将创建一个初始长度为 10 的整数切片，并返回该切片的引用。</span></span></li></ul><div id="https://www.notion.so/44d7520b4a4343d6ba603de20a354e16" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">new always allocate memory on heap?</strong></span></span></p></div><div id="https://www.notion.so/ba2818c8c76543e395d69a27df84b67c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">In Go, the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">new</code></span><span class="SemanticString"> function always returns a pointer to a newly allocated zeroed value of the specified type. However, whether that memory is allocated on the heap or not depends on the context in which the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">new</code></span><span class="SemanticString"> function is called. If it&#x27;s used with a composite literal, such as </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">new(T)</code></span><span class="SemanticString"> where </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">T</code></span><span class="SemanticString"> is a struct type, then the memory is allocated on the heap. This is because the returned pointer must survive beyond the lifetime of the function that called </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">new</code></span><span class="SemanticString">.</span></span></p></div><div id="https://www.notion.so/3f7628b43a63402e984eed869611a4e8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">However, if </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">new</code></span><span class="SemanticString"> is used with a built-in type or an array type, then the memory is allocated on the stack if possible. This is because these types have a fixed size and can be efficiently allocated on the stack.</span></span></p></div><h1 id="https://www.notion.so/ec83d33fc67a4a65ba9f9574aad94b8d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/ec83d33fc67a4a65ba9f9574aad94b8d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Escape</span></span></h1><div id="https://www.notion.so/7a7c233a134c4918a973cffb02d5a0c6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">go中，这段代码是不会出问题的 rnm，退钱！！！</span></span></p></div><pre id="https://www.notion.so/d0806b5562534521b2952d0746c3f90c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package main

func foo(arg_val int)(*int) {

    var foo_val int = 11;
    return &amp;foo_val;
}

func main() {

    main_val := foo(666)

    println(*main_val)
}</span></span></span></code></pre><div id="https://www.notion.so/78ee7b61e5fd4704b917adfa7ada40e8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">go语言编译器会自动决定把一个变量放在栈还是放在堆，编译器会做</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">逃逸分析(escape analysis)</strong></span><span class="SemanticString">，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">当发现变量的作用域没有跑出函数范围，就可以在栈上，反之则必须分配在堆</strong></span><span class="SemanticString">。go语言声称这样可以释放程序员关于内存的使用限制，更多的让程序员关注于程序功能逻辑本身。</span></span></p></div><div id="https://www.notion.so/eb911ee8ddee428e9cb91ecca4723fad" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">简而言之，不管你想把变量放到栈上还是堆上，编译器觉得应该放在哪，那它就得放在哪，一切以程序的运行逻辑为准。</span></span></p></div><h1 id="https://www.notion.so/cdb213c0c8124d79975a283f87753977" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/cdb213c0c8124d79975a283f87753977"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Pointer type &amp; struct type </span></span></h1><pre id="https://www.notion.so/8e20ca6106df4f448bba9fa9b2f5b25c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package main

import &quot;fmt&quot;

type User struct {
    Name string
}

func (u *User) Greeting() string {
    u.Name = u.Name+&quot; modify&quot;
    return fmt.Sprintf(&quot;Greetings %s!&quot;, u.Name)
}

func main() {
    p := &amp;User{&quot;cppgohan by pointer&quot;}
    u := User{&quot;cppgohan by value&quot;}

    fmt.Println(p.Greeting(), p)
    fmt.Println(u.Greeting(), u)
}</span></span></span></code></pre><div id="https://www.notion.so/a24d29f331f34bb597e9678c2fe5be16" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">p.Greeting()</code></span><span class="SemanticString">和 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">u.Greeting()</code></span><span class="SemanticString">的调用方式本质上没有区别</span></span></p></div><div id="https://www.notion.so/b840b8e89e72435b9ebd60ee5e5489a4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">p</code></span><span class="SemanticString">，调用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Greeting()</code></span><span class="SemanticString"> 就是 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">p.Greeting()</code></span><span class="SemanticString">。对于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">u</code></span><span class="SemanticString"> 隐式转换为调用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">(&amp;u).Greeting()</code></span></span></p></div><h1 id="https://www.notion.so/730abf03560249b08a28c0d26ede956a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/730abf03560249b08a28c0d26ede956a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Garbage collection (IMPORTANT!)</span></span></h1><div id="https://www.notion.so/8acb0651303a4a28b42ab2d1fef11972" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/aceld/golang/blob/main/5%E3%80%81Golang%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%2B%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9CGC%E6%A8%A1%E5%BC%8F%E5%85%A8%E5%88%86%E6%9E%90.md">Golang三色标记 混合写屏障GC模式全分析</a></span></span></p></div><div id="https://www.notion.so/f1ef7bb121514d57ae7f4a4939bdfb1d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">mark and sweep algorithm</strong></span></span></p></div><div id="https://www.notion.so/8843c44300ee426f9669bff371784878" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">此算法主要有两个主要的步骤：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/524cf94084e8469a80d3db41119efe5b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">标记(Mark phase)</span></span></li><li id="https://www.notion.so/593f59c8541b4a6a82fda6630b1bd825" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">清除(Sweep phase)</span></span></li></ul><div id="https://www.notion.so/4eb4a083937f49cda40438a38bf09bf6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Mark and Sweep算法在执行的时候，需要程序暂停，即 STW（Stop The World）。STW的过程中，CPU不执行用户代码，全部用于垃圾回收，这个过程的影响很大，所以STW也是一些回收机制最大的难题和希望优化的点。</span></span></p></div><h2 id="https://www.notion.so/a24495e9a84a4472862f421119a42833" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/a24495e9a84a4472862f421119a42833"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">一些理解</span></span></h2><div id="https://www.notion.so/9b021af2dacf444fb77a0496f86b0320" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">想要理解gc，首先需要理解的是堆和栈的区别，栈空间的特点是容量小,但是要求相应速度快,因为函数调用弹出频繁使用，所以我们希望的是尽可能地减少gc和栈的关联，或者说对栈的元素的gc应该速战速决。</span></span></p></div><div id="https://www.notion.so/2ec16ae45eff4c19bf335dc6847a49b4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Math" data-latex="写屏障=插入屏障+删除屏障"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>写屏障</mtext><mo>=</mo><mtext>插入屏障</mtext><mo>+</mo><mtext>删除屏障</mtext></mrow><annotation encoding="application/x-tex">写屏障=插入屏障+删除屏障</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">写</span><span class="mord cjk_fallback">屏</span><span class="mord cjk_fallback">障</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">插</span><span class="mord cjk_fallback">入</span><span class="mord cjk_fallback">屏</span><span class="mord cjk_fallback">障</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">删</span><span class="mord cjk_fallback">除</span><span class="mord cjk_fallback">屏</span><span class="mord cjk_fallback">障</span></span></span></span></span></span></span></p></div><div id="https://www.notion.so/4c8b5e5770af4645b6aa3f7b674fb74f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">插入屏障为了解决这个问题，基于强三色不变式在开始和结束的时间对栈进行了两次扫描，第一次为并发扫描，第二次为STW</span></span></p></div><div id="https://www.notion.so/0de63600e756405ab2b858f2c557c6e0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">基于弱三色不变式的删除屏障是比较难理解的（删除屏障中就已经开启了插入屏障，来应对堆区黑色对象引用新建的孤独对象的情况），这里写一下我的理解。设父对象为</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">x</code></span><span class="SemanticString">，其引用对象为</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">y</code></span><span class="SemanticString">，最基础的删除屏障，是将删除的引用全部变为灰色（除非已经是黑色），对栈和堆的对象都是有效的。分两种情况讨论：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/7cfb58c48598432c984c975360a1776f" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">父对象本来就不可达：此时，反而是救活了这个本应该被删除的对象，但是对不可达对象的操作本来就是违规的（涉及野指针），可以不考虑。</span></span></li><li id="https://www.notion.so/f9b306b338a148ecb63ddbd5e8b1215c" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">父对象可达：可以等价认为可达</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">y</code></span><span class="SemanticString">的链路上存在灰色对象，此时，为了让其他的黑色对象（特指栈上的黑色对象，因为栈上的对象不开启写屏障）可以自由引用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">y</code></span><span class="SemanticString">和</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">y</code></span><span class="SemanticString">链路上的子对象（在删除屏障之前，不然又是野指针了），需要将</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">y</code></span><span class="SemanticString">无脑变灰来满足弱三色不等式。</span></span></li></ol><div id="https://www.notion.so/21f0987f6f4a497ba7d12d8a2f861787" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以理解到，如果</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">y</code></span><span class="SemanticString">和</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">y</code></span><span class="SemanticString">链路上的子对象没有被黑色对象引用，那么删除屏障实际上是活佛再世，抬了这些入土半截的对象一手，回收精度是偏低的。</span></span></p></div><div id="https://www.notion.so/39974b80bbf74577bed50d9d28aa7576" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4bf3ed8a-98c2-4da6-a69b-5cc4b3e582d6%2FUntitled.png?width=480&amp;table=block&amp;id=39974b80-bbf7-4577-bed5-0d9d28aa7576"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4bf3ed8a-98c2-4da6-a69b-5cc4b3e582d6%2FUntitled.png?width=480&amp;table=block&amp;id=39974b80-bbf7-4577-bed5-0d9d28aa7576" style="width:480px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/9f065f985a374348a8554507e847db4d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">那么混合写屏障呢？</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/6327eaf6caa3411ab6b5bfbb68c3d9f8" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">前面说到的插入屏障明显针对的是堆区的元素为黑色的情况，加之中途还可能有新创建的栈对象，所以最后还要使用STW进行栈对象的清理。删除屏障也是没有考虑中途加入的栈元素。于是，可以优化的是：</span></span><div id="https://www.notion.so/df17ea14e2b84c41b6a66c0358f09826" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">栈上新加入的对象直接变黑</span></span></p></div></li><li id="https://www.notion.so/6bd469f1586045d0b658fc8bdb3a573c" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">对于删除屏障的栈对象：</span></span><div id="https://www.notion.so/69d320ed881f46a5bcb31a79b64e08be" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">你一个一个从白变灰变黑，回收精度还没提高多少，不如一步到位，在开始的时候就并发扫描直接变黑</span></span></p></div></li><li id="https://www.notion.so/9cd24defe55140d2989bd58edd17803f" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">既然栈对象直接就黑了：</span></span><div id="https://www.notion.so/2fe65091f3b3498b9a56ef77f6591524" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">堆区的对象可能被栈区的黑色对象引用，删除屏障的祖宗之法不可变</span></span></p></div></li><li id="https://www.notion.so/b248ce783c0b487da0653176f5cea20d" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">连带的：</span></span><div id="https://www.notion.so/d9f6d2413aa94891a2e2366cdf0d3666" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">堆区的插入屏障作为删除屏障的影子，也就跟着了。</span></span></p></div></li></ol><div id="https://www.notion.so/23fa92015edb40e797b51c217ff66232" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">写屏障（删除屏障+插入屏障），其根本目的就是为了保护对象不被删除。而混合写屏障则是结合了go并发的优势，尽可能减少STW的gc方法。</span></span></p></div><div id="https://www.notion.so/7c7b5ec14fa240ee98bccd11f656327a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">ATTENTION: </strong></span><span class="SemanticString">混合写屏障并不能完全消除STW，尽管从原理来看，混合写屏障已经是 STW free 的了，但是由于go的高并发特性，为了使gc的结果保持一致性，在某些时候还是需要 STW 的。</span></span></p></div><h1 id="https://www.notion.so/82316c3c58d84addb96b6d59fe14cf41" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/82316c3c58d84addb96b6d59fe14cf41"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Complement</span></span></h1><h2 id="https://www.notion.so/1118f9b4570947ebb009136d01e25806" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/1118f9b4570947ebb009136d01e25806"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">map</span></span></h2><a id="https://www.notion.so/9c060d2939a2432bb06bb0bd91989a52" class="Page" href="https://www.notion.so/9c060d2939a2432bb06bb0bd91989a52"><div><div class="Page__Icon"><div class="Icon">✔️</div></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">map</span></span></div></div></a><div id="https://www.notion.so/8ad378de41994d4493a29f0a980655ae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">为什么Go语言中的map并不支持直接对map元素进行取址操作</strong></span></span></p></div><div id="https://www.notion.so/d71943fb704a4e2e8f1f08f97b83c5db" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">map</code></span><span class="SemanticString"> 中的元素存储在哈希表中，并且哈希表可能会因为容量变化而重新分配内存，因此对 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">map</code></span><span class="SemanticString"> 元素进行取址操作并不可行。如果你试图对 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">map</code></span><span class="SemanticString"> 元素进行取址操作，编译器会报错，提示可能导致指针无效。简而言之，对map元素的修改可能会导致哈希表rehash，所以不能直接修改。在并发程序中，可以使用互斥锁来保证在并发程序中对 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">map</code></span><span class="SemanticString"> 进行安全的访问和修改。另外，还可以考虑使用 Go 语言提供的并发安全的映射类型 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sync.Map</code></span><span class="SemanticString">，它可以安全地在多个 goroutine 中读取和写入数据。</span></span></p></div><div id="https://www.notion.so/083625ba97b54540b4a6160d0ececbc7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">以下代码有什么问题，说明原因</strong></span></span></p></div><pre id="https://www.notion.so/d79ae3680ebf44c3ab5cbd2690b8fce1" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package main

import (
    &quot;fmt&quot;
)

type student struct {
    Name string
    Age  int
}

func main() {
    //定义map
    m := make(map[string]*student)

    //定义student数组
    stus := []student{
        {Name: &quot;zhou&quot;, Age: 24},
        {Name: &quot;li&quot;, Age: 23},
        {Name: &quot;wang&quot;, Age: 22},
    }

    //将数组依次添加到map中
    for _, stu := range stus {
        m[stu.Name] = &amp;stu
    }

    //打印map
    for k,v := range m {
        fmt.Println(k ,&quot;=&gt;&quot;, v.Name)
    }
}</span></span></span></code></pre><div id="https://www.notion.so/10bf574f538c4b0dbff70a35f0b08f24" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">遍历结果出现错误，输出结果为</span></span></p></div><pre id="https://www.notion.so/52dd26e003c24e8ab7f2a33d2c2327db" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>zhou =&gt; wang
li =&gt; wang
wang =&gt; wang</span></span></span></code></pre><div id="https://www.notion.so/7d3c6a1ba45d4801b78d69d63634bc10" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">map中的3个key均指向数组中最后一个结构体。</span></span></p></div><pre id="https://www.notion.so/dbd2af02044043d8bea0ba3135249169" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>0xc000010030
0xc000010030
0xc000010030
zhou =&gt; wang
li =&gt; wang
wang =&gt; wang</span></span></span></code></pre><div id="https://www.notion.so/afefaa36ca1e4132aba818f1413b68b4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">从内存的角度来看，3个key都对应 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&amp;stu</code></span><span class="SemanticString">这个指针，这个指针的内存地址是临时的，同时也可以推断出在golang中，for循环的临时变量的虚拟地址是复用的。所以结果出错。</span></span></p></div><div id="https://www.notion.so/e53f12270c4a4d449d1cd286e59dede4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">正确写法</strong></span></span></p></div><pre id="https://www.notion.so/fe98b7268da1472e93958ff2fbae7837" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>// 遍历结构体数组，依次赋值给map
for i := 0; i &lt; len(stus); i++  {
    m[stus[i].Name] = &amp;stus[i]
}</span></span></span></code></pre><h2 id="https://www.notion.so/2fb6624370db49608f40b9ca8ca55826" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/2fb6624370db49608f40b9ca8ca55826"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">slice</span></span></h2><a id="https://www.notion.so/18f0fae1b7ca40eab7254e69404429dc" class="Page" href="https://www.notion.so/18f0fae1b7ca40eab7254e69404429dc"><div><div class="Page__Icon"><div class="Icon">✔️</div></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">slice</span></span></div></div></a><h2 id="https://www.notion.so/dc9a4365b2b74896a29989c98639f914" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/dc9a4365b2b74896a29989c98639f914"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">compile</span></span></h2><a id="https://www.notion.so/b8cbb8f9f7024a43943c02a6e39683d5" class="Page" href="https://www.notion.so/b8cbb8f9f7024a43943c02a6e39683d5"><div><div class="Page__Icon"><div class="Icon">✔️</div></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">compile</span></span></div></div></a><h2 id="https://www.notion.so/5bed3069fd7b465faeb0d8d5e9a3ff66" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5bed3069fd7b465faeb0d8d5e9a3ff66"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">context</span></span></h2><a id="https://www.notion.so/34f4d4af812e4e56a6dddeb96e7f605c" class="Page" href="https://www.notion.so/34f4d4af812e4e56a6dddeb96e7f605c"><div><div class="Page__Icon"><svg viewBox="0 0 30 30" style="width:1.1875em;height:1.1875em;fill:inherit;opacity:0.8"><g><path d="M16,1H4v28h22V11L16,1z M16,3.828L23.172,11H16V3.828z M24,27H6V3h8v10h10V27z M8,17h14v-2H8V17z M8,21h14v-2H8V21z M8,25h14v-2H8V25z"></path></g></svg></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">context</span></span></div></div></a><h2 id="https://www.notion.so/34705a0814c24354bf34ff9d65e760e8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/34705a0814c24354bf34ff9d65e760e8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">reflect</span></span></h2><a id="https://www.notion.so/6ff91a18494e4ffca33bb9fd2c36f43f" class="Page" href="https://www.notion.so/6ff91a18494e4ffca33bb9fd2c36f43f"><div><div class="Page__Icon"><svg viewBox="0 0 30 30" style="width:1.1875em;height:1.1875em;fill:inherit;opacity:0.8"><g><path d="M16,1H4v28h22V11L16,1z M16,3.828L23.172,11H16V3.828z M24,27H6V3h8v10h10V27z M8,17h14v-2H8V17z M8,21h14v-2H8V21z M8,25h14v-2H8V25z"></path></g></svg></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">reflect</span></span></div></div></a><h2 id="https://www.notion.so/c20c1bf6fbdc45a4ab01caebea5ebdf6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/c20c1bf6fbdc45a4ab01caebea5ebdf6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">unsafe</span></span></h2><a id="https://www.notion.so/4bac355b24f049e7a317e4f1cad63c79" class="Page" href="https://www.notion.so/4bac355b24f049e7a317e4f1cad63c79"><div><div class="Page__Icon"><svg viewBox="0 0 30 30" style="width:1.1875em;height:1.1875em;fill:inherit;opacity:0.8"><g><path d="M16,1H4v28h22V11L16,1z M16,3.828L23.172,11H16V3.828z M24,27H6V3h8v10h10V27z M8,17h14v-2H8V17z M8,21h14v-2H8V21z M8,25h14v-2H8V25z"></path></g></svg></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">unsafe</span></span></div></div></a><h2 id="https://www.notion.so/17324127239b4a08bf1a4c164f0be21f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/17324127239b4a08bf1a4c164f0be21f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">interface</span></span></h2><a id="https://www.notion.so/e339a686bbb141d9b6b518111e72a68c" class="Page" href="https://www.notion.so/e339a686bbb141d9b6b518111e72a68c"><div><div class="Page__Icon"><svg viewBox="0 0 30 30" style="width:1.1875em;height:1.1875em;fill:inherit;opacity:0.8"><g><path d="M16,1H4v28h22V11L16,1z M16,3.828L23.172,11H16V3.828z M24,27H6V3h8v10h10V27z M8,17h14v-2H8V17z M8,21h14v-2H8V21z M8,25h14v-2H8V25z"></path></g></svg></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">interface</span></span></div></div></a><h2 id="https://www.notion.so/b8fd5d9dc27d4b5bb53e9c536b09e85d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b8fd5d9dc27d4b5bb53e9c536b09e85d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">channel</span></span></h2><a id="https://www.notion.so/232ae8ce5ec34737a18e077774b84b1e" class="Page" href="https://www.notion.so/232ae8ce5ec34737a18e077774b84b1e"><div><div class="Page__Icon"><svg viewBox="0 0 30 30" style="width:1.1875em;height:1.1875em;fill:inherit;opacity:0.8"><g><path d="M16,1H4v28h22V11L16,1z M16,3.828L23.172,11H16V3.828z M24,27H6V3h8v10h10V27z M8,17h14v-2H8V17z M8,21h14v-2H8V21z M8,25h14v-2H8V25z"></path></g></svg></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">channel</span></span></div></div></a><h2 id="https://www.notion.so/6d568857939045de94583f27517fe07b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6d568857939045de94583f27517fe07b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">GMP</span></span></h2><a id="https://www.notion.so/0b90335923374ad9adefe77b69142581" class="Page" href="https://www.notion.so/0b90335923374ad9adefe77b69142581"><div><div class="Page__Icon"><svg viewBox="0 0 30 30" style="width:1.1875em;height:1.1875em;fill:inherit;opacity:0.8"><g><path d="M16,1H4v28h22V11L16,1z M16,3.828L23.172,11H16V3.828z M24,27H6V3h8v10h10V27z M8,17h14v-2H8V17z M8,21h14v-2H8V21z M8,25h14v-2H8V25z"></path></g></svg></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">GMP</span></span></div></div></a><div id="https://www.notion.so/439a8faf09e641cba52ed480c0d82a3a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/aceld/golang/blob/main/2%E3%80%81Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3%EF%BC%9F.md">Golang的协程调度器原理及GMP设计思想</a></span><span class="SemanticString"> </span></span></p></div><div id="https://www.notion.so/1afffb7dfb7647fdb295113f39b4e527" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/aceld/golang/blob/main/3%E3%80%81%E5%AF%B9%E4%BA%8E%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%80%8C%E8%A8%80%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%BB%A5%E5%8F%8AGoroutine%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB.md">对于操作系统而言进程、线程以及Goroutine协程的区别</a></span></span></p></div><div id="https://www.notion.so/ee06f979c4554278a895c951b144f901" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">控制goroutines数量</strong></span></span></p></div><div id="https://www.notion.so/a610eceb45cb4a63b2ed6cd3093d41ed" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/aceld/golang/blob/main/4%E3%80%81Go%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E6%97%A0%E9%99%90go%EF%BC%9F%E5%A6%82%E4%BD%95%E9%99%90%E5%AE%9A%E6%95%B0%E9%87%8F%EF%BC%9F.md">Go是否可以无限go？如何限定数量？</a></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/023fc0cbae314fb48fb13f0373d4d875" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">方法一：只是用有buffer的channel来限制 (无法等待回收goroutine结束，资源回收)</span></span></li><li id="https://www.notion.so/e92c0554681d476a85d0ac7b54b53859" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">方法二：只使用sync同步机制 (无法控制数量)</span></span></li><li id="https://www.notion.so/36a193d1516a4453a0cb39388195203f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">方法三：channel与sync同步组合方式 (perfect)</span></span></li><li id="https://www.notion.so/18dda6cd22ef4ccea3b0475451827ff5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">方法四：利用无缓冲channel与任务发送/执行分离方式</span></span></li></ul><div id="https://www.notion.so/2e422d5c33954dddaf271bf2284edd55" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">WaitGroup与goroutine的竞速问题</strong></span></span></p></div><div id="https://www.notion.so/fd70b9d9e4c444298e0829c1b0ffd301" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/aceld/golang/blob/main/6%E3%80%81WaitGroup.md">WaitGroup</a></span></span></p></div><div id="https://www.notion.so/3c353e8a83924534bbf5a4060ba3d8cd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">总结：在goroutine前add WaitGroup会好一些。</span></span></p></div><h1 id="https://www.notion.so/b8c4fd33b8b74519bcb53a007170d2fe" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/b8c4fd33b8b74519bcb53a007170d2fe"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">GO实战</span></span></h1><h2 id="https://www.notion.so/5e78559701aa4ddeb976beda3a612475" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5e78559701aa4ddeb976beda3a612475"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Web</span></span></h2><a id="https://www.notion.so/41b3a810672e4f6a9a3c5b79dc286a46" class="Page" href="https://www.notion.so/41b3a810672e4f6a9a3c5b79dc286a46"><div><div class="Page__Icon"><svg viewBox="0 0 30 30" style="width:1.1875em;height:1.1875em;fill:inherit;opacity:0.8"><g><path d="M16,1H4v28h22V11L16,1z M16,3.828L23.172,11H16V3.828z M24,27H6V3h8v10h10V27z M8,17h14v-2H8V17z M8,21h14v-2H8V21z M8,25h14v-2H8V25z"></path></g></svg></div><div class="Page__Title"><span class="SemanticStringArray"><span class="SemanticString">如果我只会响应，你会爱我吗</span></span></div></div></a></article>
  <footer class="Footer">
  <div>&copy; humblog 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>